<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>@ViewBag.Title - eShop System</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="shortcut icon" href="@Url.Content("~/dist/img/favicon.ico")" type="image/x-icon">

    @RenderSection("Styles", required: false)
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="@Url.Content("~/dist/css/skins/skin-" + User.Identity.GetSkin() + ".min.css")">
    <!-- Bootstrap 3.3.7 -->
    @Styles.Render("~/style/bootsrap")
    <!-- Font Awesome -->
    @Styles.Render("~/style/font-awesome")
    <!-- Ionicons -->
    @Styles.Render("~/style/ionicons")
    <!-- Theme style -->
    @Styles.Render("~/style/AdminLTE")

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Google Font -->
    @Styles.Render("~/style/GoogleFont")

    @Styles.Render("~/style/loading")

    @Styles.Render("~/style/Common")
</head>
<body class="hold-transition skin-@User.Identity.GetSkin() sidebar-mini @((User.Identity.GetToggleSidebar() == "True") ? "" : "sidebar-collapse") fixed">
    <!-- Site wrapper -->
    <div id="loading" class="loading" style="display:none"></div>
    <div class="wrapper">

        <header class="main-header">
            @Html.Partial("_Header")
        </header>

        <!-- =============================================== -->
        <!-- Left side column. contains the sidebar -->
        <aside class="main-sidebar">
            @Html.Partial("_Sidebar")
        </aside>

        <!-- =============================================== -->
        <!-- Content Wrapper. Contains page content -->
        @RenderBody()
        <!-- /.content-wrapper -->

        <footer class="main-footer">
            <div class="pull-right hidden-xs">
                <b>Version</b> 2.0
            </div>
            <strong>Copyright &copy; @DateTime.Now.Year.ToString() <a href="mailto:junrikson@gmail.com" target="_blank">eShop System</a>.</strong> All rights reserved.
        </footer>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            @Html.Partial("_ControlSidebar")
        </aside>
        <!-- /.control-sidebar -->
        <!-- Add the sidebar's background. This div must be placed
             immediately after the control sidebar -->
        <div class="control-sidebar-bg"></div>
    </div>

    <div id="ChatContainer" class="chat-popup">
        @{Html.RenderAction("Chat", "Chats");}
    </div>

    <button id="ChatButton" class="open-chat-button btn btn-primary" onclick="openChat()"><i style="font-size:30px" class="fa fa-comments" aria-hidden="true"></i></button>
    <!-- ./wrapper -->
    <!-- jQuery 3 -->
    @Scripts.Render("~/script/jQuery")
    <!-- Bootstrap 3.3.7 -->
    @Scripts.Render("~/script/bootstrap")
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.4.3.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!-- SlimScroll -->
    @Scripts.Render("~/script/SlimScroll")
    <!-- FastClick -->
    @Scripts.Render("~/script/FastClick")
    <!-- AdminLTE App -->
    @Scripts.Render("~/script/AdminLTE")
    <!-- BootBox -->
    @Scripts.Render("~/script/bootbox")
    <!-- screenfull -->
    @Scripts.Render("~/bundles/screenfull")
    <!-- cookie -->
    @Scripts.Render("~/script/cookie")

    @RenderSection("Scripts", required: false)

    <!-- Common -->
    @Scripts.Render("~/script/Common")

<script>
        $(document).ready(function () {
            fetchNotifications();
        });

        function fetchNotifications() {
            @{
                if(User.IsInRole("ForwardingSellingOthersActive") || User.IsInRole("ForwardingJobOrderOthersActive"))
            {
            <text>
            var token = $('input[name="__RequestVerificationToken"]').val();
            var headers = {};
            headers['__RequestVerificationToken'] = token;

            $.ajax({
                url: '/Notifications/ForwardingJobOthers',
                type: 'POST',
                headers: headers,
                contentType: 'application/json',
                dataType: 'json',
                global: false,
                success: function (data) {
                    if (data.length > 0) {
                        var details = '';
                        data.forEach((element) => {
                            details = details + '<li><a href="#"> <i class="fa fa-check text-red"></i> Job Order ' + element.Code + ' is Ready!</a></li>';
                        });
                        document.getElementById("AjaxNotifications").innerHTML =
                            '<a href="#" class="dropdown-toggle" data-toggle="dropdown">' +
                            '<i class="fa fa-bell-o fa-pulse"></i>' +
                            '<span class="label label-warning">' + data.length + '</span>' +
                            '</a>' +
                            '<ul class="dropdown-menu">' +
                            '<li class="header">You have ' + data.length + ' notifications</li>' +
                            '<li><ul class="menu">' + details + '</ul></li>' +
                            '<li class="footer"><a href="#">' + data.length + ' notifications</a></li>' +
                            '</ul>';
                    }
                    else {
                        document.getElementById("AjaxNotifications").innerHTML =
                            '<a href="#" class="dropdown-toggle" data-toggle="dropdown">' +
                            '<i class="fa fa-bell-o"></i>' +
                            '</a>' +
                            '<ul class="dropdown-menu">' +
                            '<li class="header">You have no notifications</li>' +
                            '<li class="footer"><a href="#">0 notifications</a></li>' +
                            '</ul>';
                    }
                },
                complete: function (data) {
                    setTimeout(fetchNotifications, 60000);
                }
            });
            </text>
            }
             }
        }
</script>
</body>
</html>
